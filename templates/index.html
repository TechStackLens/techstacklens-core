{% extends 'base.html' %}

{% block title %}TechStackLens - IT Infrastructure Assessment Tool{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="card mb-4 bg-dark text-light">
            <div class="card-body text-center">
                <h1 class="card-title">
                    <i class="fas fa-network-wired me-2"></i>TechStackLens
                </h1>
                <p class="lead">An open-source IT assessment tool designed to scan environments, map dependencies, and visualize flows for solution architects</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-info-circle me-2"></i>System Status</h5>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Local IP Address
                        <span class="badge bg-secondary">{{ local_ip }}</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Admin Privileges
                        <span class="badge {% if admin_status %}bg-success{% else %}bg-danger{% endif %}">
                            {% if admin_status %}Yes{% else %}No{% endif %}
                        </span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Nmap Installation
                        <span class="badge {% if nmap_installed %}bg-success{% else %}bg-danger{% endif %}">
                            {% if nmap_installed %}Installed{% else %}Not Found{% endif %}
                        </span>
                    </li>
                </ul>
                
                {% if not admin_status %}
                <div class="alert alert-warning mt-3">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Some scanner features require administrator privileges
                </div>
                {% endif %}
                
                {% if not nmap_installed %}
                <div class="alert alert-warning mt-3">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Network scanning requires Nmap to be installed
                </div>
                {% endif %}
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-upload me-2"></i>Import Results</h5>
            </div>
            <div class="card-body">
                <form action="/upload_results" method="post" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="results_file" class="form-label">Upload Scan Results:</label>
                        <input type="file" class="form-control" id="results_file" name="results_file" accept=".json">
                        <div class="form-text">Upload previously saved scan results in JSON format.</div>
                    </div>
                    <button type="submit" class="btn btn-primary"><i class="fas fa-upload me-2"></i>Upload</button>
                </form>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-sync-alt me-2"></i>Reset</h5>
            </div>
            <div class="card-body">
                <form action="/reset" method="post">
                    <p>Reset all scan results and analysis data.</p>
                    <button type="submit" class="btn btn-danger"><i class="fas fa-trash-alt me-2"></i>Reset Application</button>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-search me-2"></i>Run Scans</h5>
            </div>
            <div class="card-body">
                <ul class="nav nav-tabs" id="scanTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="iis-tab" data-bs-toggle="tab" data-bs-target="#iis-scan" type="button" role="tab" aria-controls="iis-scan" aria-selected="true">IIS Scan</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="network-tab" data-bs-toggle="tab" data-bs-target="#network-scan" type="button" role="tab" aria-controls="network-scan" aria-selected="false">Network Scan</button>
                    </li>
                </ul>
                
                <div class="tab-content mt-3" id="scanTabsContent">
                    <!-- IIS Scan Tab -->
                    <div class="tab-pane fade show active" id="iis-scan" role="tabpanel" aria-labelledby="iis-tab">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h5>IIS Configuration Scanner</h5>
                                <p>This scanner will analyze IIS configuration files to extract site bindings, SNI hostnames, and application types.</p>
                                
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Scans applicationHost.config and web.config files to detect IIS sites and applications.
                                </div>
                                
                                <form action="/scan" method="post">
                                    <input type="hidden" name="scan_type" value="iis">
                                    <button type="submit" class="btn btn-primary" {% if not admin_status %}disabled{% endif %}>
                                        <i class="fas fa-search me-2"></i>Run IIS Scan
                                    </button>
                                    {% if not admin_status %}
                                    <div class="form-text text-danger">Administrator privileges required for this scan.</div>
                                    {% endif %}
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Network Scan Tab -->
                    <div class="tab-pane fade" id="network-scan" role="tabpanel" aria-labelledby="network-tab">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h5>Network Scanner</h5>
                                <p>This scanner uses nmap to discover hosts and services on the network.</p>
                                
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Scans for web servers, databases, middleware, and other services.
                                </div>
                                
                                <form action="/scan" method="post">
                                    <input type="hidden" name="scan_type" value="network">
                                    <div class="mb-3">
                                        <label for="network_range" class="form-label">Network Range:</label>
                                        <input type="text" class="form-control" id="network_range" name="network_range" 
                                               placeholder="e.g., 192.168.1.0/24" value="{{ local_ip }}/24" required>
                                        <div class="form-text">Specify IP range in CIDR notation (e.g., 192.168.1.0/24) or a single IP.</div>
                                    </div>
                                    <button type="submit" class="btn btn-primary" {% if not nmap_installed %}disabled{% endif %}>
                                        <i class="fas fa-search me-2"></i>Run Network Scan
                                    </button>
                                    {% if not nmap_installed %}
                                    <div class="form-text text-danger">Nmap is required for this scan but was not found.</div>
                                    {% endif %}
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-chart-network me-2"></i>Analysis & Reporting</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card bg-light h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-project-diagram fa-3x mb-3"></i>
                                <h5>Analyze Dependencies</h5>
                                <p>Map dependencies between hosts and services</p>
                                <form action="/analyze" method="post">
                                    <button type="submit" class="btn btn-primary" {% if not scan_completed %}disabled{% endif %}>
                                        <i class="fas fa-cogs me-2"></i>Analyze
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <div class="card bg-light h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-eye fa-3x mb-3"></i>
                                <h5>View Visualization</h5>
                                <p>Interactive dependency graph</p>
                                <a href="/visualization" class="btn btn-primary" {% if not analysis_completed %}disabled{% endif %}>
                                    <i class="fas fa-chart-network me-2"></i>View
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <div class="card bg-light h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-file-alt fa-3x mb-3"></i>
                                <h5>Generate Report</h5>
                                <p>Create comprehensive assessment report</p>
                                <form action="/generate_report" method="post">
                                    <button type="submit" class="btn btn-primary" {% if not analysis_completed %}disabled{% endif %}>
                                        <i class="fas fa-file-export me-2"></i>Generate
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-3">
                    <a href="/report" class="btn btn-outline-secondary" {% if not report_generated %}disabled{% endif %}>
                        <i class="fas fa-file-pdf me-2"></i>View Generated Report
                    </a>
                </div>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-info-circle me-2"></i>About TechStackLens</h5>
            </div>
            <div class="card-body">
                <p>TechStackLens is a lightweight, open-source IT assessment tool designed to scan environments, map dependencies, and visualize flows for solution architects.</p>
                
                <h6>Features:</h6>
                <ul>
                    <li><strong>Scanner Kit:</strong> Stack-specific tools to collect configuration and network data</li>
                    <li><strong>Analyzer:</strong> Identifies dependencies and gaps from scanner output</li>
                    <li><strong>Visualizer:</strong> Displays interactive dependency maps</li>
                    <li><strong>Report Generator:</strong> Creates actionable reports</li>
                </ul>
                
                <p>This tool is designed to help solution architects understand existing environments, identify dependencies, and plan migrations or upgrades.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
